/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * user guide available at https://docs.gradle.org/3.5/userguide/java_library_plugin.html
 */

plugins {
  id "java"
  id 'eclipse'
  id 'idea'
}


// In this section you declare where to find the dependencies of your project
repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    mavenCentral()
}

dependencies {
	// cup
    compile 'com.github.vbmacher:java-cup:11b-20160615'
    // jflex
    compile 'de.jflex:jflex:1.6.1'
}

// on reutilise la tache ant pour jflex
task jflex {
	ext.destdir = file("${buildDir}/generated-src/jflex")
	ext.source = fileTree ( 'src/main/jflex'){
		include "**/*.jflex"
	}
	ant.taskdef(name:'jflex', classpath:sourceSets.main.runtimeClasspath.asPath,  classname:"jflex.anttask.JFlexTask")
	doLast {
		println "jflex source --> ${jflex.source}"
		println "jflex dest --> ${jflex.destdir}"
		sourceSets.main.java.srcDir jflex.destdir
		source.each { File f -> 
			println "jflex source --> ${f}"
			ant.jflex(file:f, destdir:destdir, nobak:"true", verbose:"on")
		}
	}
}

// on reutilise la tache ant pour cup
task cup {
	ext.destdir = file("${buildDir}/generated-src/cup")
	ext.source = fileTree ('src/main/cup'){
		include "**/*.cup"
	}	
	ant.taskdef(name:'cup', classpath:sourceSets.main.runtimeClasspath.asPath,  classname:"java_cup.anttask.CUPTask")
	doLast {
		println "cup source --> ${cup.source}"
		println "cup dest --> ${cup.destdir}"
		sourceSets.main.java.srcDir cup.destdir 	
		source.each { File f -> 
			println "cup source --> ${f}"
			ant.cup(srcfile:f, destdir:destdir, force:'true', dump:"off")
		}
	}
}

clean.doFirst {
	delete jflex.destdir
	delete cup.destdir		
}

task ide {
	eclipseClasspath.dependsOn ide
	ideaModule.dependsOn ide
	doFirst {
		mkdir jflex.destdir
		mkdir cup.destdir		
		sourceSets.main.java.srcDir cup.destdir
		sourceSets.main.java.srcDir jflex.destdir
	}
}

compileJava.dependsOn cup, jflex

sourceSets {
	main {
   		java {
    	}
    	jflex {
		//	source =  fileTree ( 'src/main/jflex'){
		//		include "**/*.jflex"
		//	}
		//	destdir = file("${buildDir}/generated-src/jflex")
		}	
		cup {
		//	source =  fileTree ('src/main/cup'){
		//		include "**/*.cup"
		//	}
		//	destdir = file("${buildDir}/generated-src/cup")
		}	
		ide 
   	}
}
